# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

**Способы оплаты**

```TypeScript
export type TPaymentMethod = 'card' | 'cash' | '';
```

**Карточка**

```TypeScript
export interface ICard {
id: string;
title: string;
image: string;
category: string;
price: number | null;
description: string;
}
```

**Интерфейс класса данных каталога карточек**

```TypeScript
export interface ICardsData {
cards: ICard[];
preview: string | null;
events: IEvents;
getCards ():ICard[];
saveCards (cards: ICard[]): void;
savePreview (cards: ICard[]): void;
getCard(id: string): ICard[];
}
```

**Данные покупателя**

```TypeScript
export interface IUser {
payment: TPaymentMethod
address: string;
email: string;
phone: string;
}
```

**Интерфейс класса данных покупателя**

```TypeScript
export interface IUserData {
payment: TUserPayment
address: string;
email: string;
phone: string;
getUserinfo (): IUser;
validateUser (): boolean;
saveUser (userData: IUser): void;
}
```

**Интерфейс класса данных корзины**

```TypeScript
export interface IBasketData {
Cards: ICard[];
addCard (card: ICard[]): void;
removeCard (id: string): void;
getTotalPrice(cards: ICard[]): number;
getCards (): ICard[];
isInBasket (id: string): boolean;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов.\ В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе.  Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек, созданных пользователями.
Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- `cards: ICard[]` - массив объектов карточек
- `preview: string | null` - id карточки, выбранной для просмотра в модальном окне
- `events: IEvents` — экземпляр класса `EventEmitter` для инициации событий при изменении данных

Так же класс предоставляет набор методов для взаимодействия с этими данными

- `getCards ():ICard[]` - возвращает массив карточек;
- `saveCards (cards: ICard[]): void` - сохраняет массив карточек;
- `savePreview (cards: ICard[]): void` - принимает и сохраняет инстанс карточки;
- `getCard(id: string): ICard[]` - возвращает карточку по её id;

#### Класс UserData
Класс отвечает за хранение и валидацию данных текущего пользователя.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `payment: TUserPayment` - способ оплаты;
- `address: string` - адрес;
- `email: string` - email;
- `phone: string` - номер телефона;

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- `getUserinfo (): IUser` - возвращает основные данные пользователя;
- `validateUser (): boolean` - валидирует данные пользователя;
- `saveUser (userData: Partial<IUser>): void` - Принимает объект типа IUser, в котором все поля опциональные. Сохраняет данные пользователя;

#### Класс BasketData
Класс отвечает за хранение и обработку данных о товарах в корзине.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `cards: ICard[]` - массив товаров;

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- `addCard (card: ICard[]): void` - добавляет товар в корзину;
- `removeCard (id: string): void` - удаляет товар из корзины;
- `getTotalPrice(cards: ICard[]): number` - возвращает сумму товаров в корзине;
- `getCards (): ICard[]` - возвращает массив товаров, добавленных в корзину;
- `isInBasket (id: string): boolean` - проверяет наличие товара в корзине по id товара;
- 
### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления.\
В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

### Класс HeaderView
Класс для отображения шапки приложения.\
Содержит иконку корзины и отображает количество товаров, добавленных в корзину.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.


**Поля класса:**
- busketButton: HTMLButtonElement
- basketCounterEl: HTMLElement

**Методы класса:**
- set counter (cardsCount: number): void;

### Класс CatalogView
Класс для управления отображением каталога товаров.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.\
Содержит метод для отрисовки каталога карточек товаров.

**Поля класса:**
- catalogEl: HTMLElement;

**Методы класса:**
- set content (cards: HTMLElement[]): void;

### Класс ModalView
Класс для отображения модального окна.\
Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.

**Поля класса:**
- closeButton: HTMLButtonElement;

**Методы класса:**
- openModal(): void;
- closeModal(): void;
- set content:(element: HTMLElement): void;

### Класс BasketView
Класс для отображения корзины товаров.\
Содержит кнопку подтверждения оформления заказа, счетчик стоимости товаров в корзине.\
Реализует методы отрисовки стоимости товаров в корзине, установки текста у кнопки подтверждения оформления заказа.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.

**Поля класса:**
- totalPriceEl: HTMLElement;
- submitButton: HTMLButtonElement;

**Методы класса:**
- set content (cards: HTMLElement[]): void;
- set submitButtonText (text: string): void;
- set totalPrice (totalPrice: number): void;

### Класс CardBaseView
Родительский класс для всех классов отображения карточки товара.\
Содержит в себе функционал, который будут наследовать все дочерние классы представления карточки товара.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.\
Содержит DOM элементы с названием и ценой товара и методы для установки текстового содержимого этих элементов.

**Поля класса:**
- cardTitleEl: HTMLElement;
- cardPriceEl: HTMLElement;

**Методы класса:**
- set title (text: string): void;
- set price (price: number): void;

### Класс CardFullView
Родительский класс для классов карточки в каталоге и карточки в корзине.
Содержит DOM элемент с названием категории и ссылку на картинку карточки товара, а также методы для установки текстового содержимого категории и ссылки на картинку.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.

**Поля класса:**
- cardCategoryEl: HTMLElement;
- cardImageLink: string;

**Методы класса:**
- set category (text: string): void;
- set image (link: string): void;

### Класс CardInCatalogView
Потомок классов `CardBaseView` и `CardFullView`. Служит для отображения карточки товара в каталоге.\
Содержит свойства и методы родительских классов.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.

### Класс CardPreviewView
Потомок классов `CardBaseView` и `CardFullView`. Служит для отображения карточки товара в каталоге.\
Содержит свойства и методы родительского класса, а также описание, кнопку добавления товара в корзину и метод для установки текста описания.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.

**Поля класса:**
- cardDescriptionEl: HTMLElement;
- buyButton: HTMLButtonElement;

**Методы класса:**
- set description (text: string): void;

### Класс CardInBasketView
Потомок класса `CardBaseView`. Служит для отображения карточки товара в каталоге.\
Содержит свойства и методы родительского класса, а также порядковый номер товара в корзине, кнопку удаления товара из корзины, метод установки порядкового номера товара в корзине.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.

**Поля класса:**
- cardIndexEl: HTMLElement;
- deleteButton: HTMLButtonElement;

**Методы класса:**
- set index (index: number): void;

### Класс FormView
Родительский класс для всех классов отображения форм.\
Содержит в себе функционал, который будут наследовать дочерние классы представления форм.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.

**Поля класса:**
- form: HTMLFormElement;
- inputs: NodeListOf<HTMLInputElement>;
- errorsElement: HTMLElement;
- submitButton: HTMLButtonElement;

**Методы класса:**
- onInputChange (): void;
- set errors (text: string): void;
- set valid (value: boolean): void;
- getInputsValue (): Record<string, string>;

### Класс OrderFormView
Потомок класса `FormView`. Служит для отображения формы выбора оплаты и адреса доставки.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.

**Поля класса:**
- cardPaymentButton: HTMLButtonElement;
- cashPaymentButton: HTMLButtonElement;
- addressInputEl: HTMLInputElement;

**Методы класса:**
- set address (text: string): void;

### Класс ContactsFormView
Потомок класса `FormView`. Служит для отображения формы сбора контактных данных: электронной почты и номера телефона.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.

**Поля класса:**
- emailInputEl: HTMLInputElement;
- phoneInputEl: HTMLInputElement;

**Методы класса:**
- set email (text: string): void;
- set phone (text: string): void;

### Класс OrderSuccesView
Класс для отображения сообщения об успешном оформлении заказа.\
Содержит итоговую стоимость купленных товаров, кнопку закрытия окна с сообщением и метода установки значения итоговой стоимости купленных товаров.\
Конструктор класса принимает `container` - контейнер с разметкой, в котором будет происходить поиск DOM элементов.

**Поля класса:**
- totalPriceEl: HTMLElement;
- succesCloseButton: HTMLButtonElement;

**Методы класса:**
- set totalPrice (totalPrice: number): void;

### Слой коммуникации

#### Класс AppApi
Класс предоставляет методы для работы с сервером веб приложения. В конструкторе\
принимает экземпляр базового класса `Api`.

**В полях класса хранятся следующие данные:**
- `baseApi` - экземпляр базового класса `Api`.

**Методы класса:**
- `getProducts(): Promise<IProduct[]>` - получить с сервера массив товаров;
- `sendOrder(data: IOrderData): Promise<ISuccessOrder>` - отправить на сервер сформированный заказ.

### Слой взаимодействия (презентер)
Взаимодействие слоев данных и представления происходит при помощи кода, который\
описан в корневом файле `index.ts`, выполняющий роль презентера. Такое взаимодействие\
осуществляется использованием брокера событий, который позволяет генерировать\,
а так же устанавливать на такие события обработчики, запускающие нужный код.\
В файле `index.ts` сначала создаются необходимые экземпляры классов, а затем\
устанавливаются обработчики событий.

**События слоя данных, которые могут генерироваться в веб приложении:**
- `products:saved` - сохранение массива продуктов в слой данных;
- `basket:changed` - изменение массива корзины товаров;

**События слоя представления, которые могут генерироваться в веб приложении:**
- `modal:open` - модальное окно открывается;
- `modal:close` - модальное окно закрывается;
- `product:open` - открывается модальное окно с превью продукта;
- `product:buy` - нажата кнопка "Купить" в окне превью;
- `basket:open` - открывается модальное окно корзины товаров;
- `basket:delete` - нажата кнопка удаления товара в корзине;
- `basket:order` - нажата кнопка "Оформить" в корзине товаров;
- `formOrder:submit` - сохранение данных о пользователе в форме с адресом доставки;
- `formContacs:submit` - сохранение данных о пользователе в форме с почтой и телефоном.
- `formOrder:input` - изменение данных в форме заказа с адресом доставки;
- `formContacs:input` - изменение данных в форме с почтой и телефоном;
- `formOrder:onile` - выбрана онлайн оплата;
- `formOrder:cash` - выбрана оплата при получении;
- `'success:pressed'` - нажата кнопка завершения заказа.
